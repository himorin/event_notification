<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Notification system registration site</title>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons"
        rel="stylesheet">
  <link rel="stylesheet" href="global.css" type="text/css" media="all">
  <script type="text/javascript" src="global.js"></script>
</head>
<body>
<header id="disp_header">
<img src="logo.jpeg" alt="Logo" />
<span>Notification System Registration Site</span>
</header>
<div id="disp_sidebar">
<span title="List notifications" id="menu_list"><i class="material-icons">list</i></span>
<span title="Target and Scheme" id="menu_target"><i class="material-icons">publish</i></span>
<span title="Settings" id="menu_settings"><i class="material-icons">settings</i></span>
<span title="Help" id="menu_help"><i class="material-icons">help</i></span>
</div>

<div class="content">

<div id="content_list" class="panel">
<div class="operation">
<span class="mi_inline" id="input_notices_getall" title="reload"><i class="material-icons">refresh</i></span>
<span class="mi_inline" id="input_notices_delete" title="delete selected"><i class="material-icons">delete</i></span>
<span class="mi_inline" id="input_notices_showadd"><i class="material-icons">add</i></span>
<span>(<span id="input_notices_count">0</span> found)</span>
<span class="mi_inline">&nbsp;|&nbsp;</span>
<div class="show_off">
<span class="mi_inline" id="input_n_show_all" title="show all"><i class="material-icons">highlight_off</i></span>
<span class="mi_inline show_on" id="input_n_show_queued" title="show in queue"><i class="material-icons">schedule</i></span>
<span class="mi_inline" id="input_n_show_fired" title="show fired"><i class="material-icons">done</i></span>
<span class="mi_inline" id="input_n_show_deleted" title="show deleted"><i class="material-icons">remove_circle_outline</i></span>
<span class="mi_inline" id="input_n_show_invalid" title="show marked as invalid"><i class="material-icons">pause_circle_outline</i></span>
<span class="mi_inline" id="input_n_show_error" title="show error after execution"><i class="material-icons">report_problem</i></span>
<span class="mi_inline" id="input_n_show_pushed" title="show in execution"><i class="material-icons">call</i></span>
</div>
</div>
<table class="list">
<colgroup>
  <col class="tab_n_check">
  <col class="tab_n_target">
  <col class="tab_n_tid">
  <col class="tab_n_content">
  <col class="tab_n_description">
</colgroup>
<thead>
  <tr><th></th><th>Date/Time (UTC)</th><th>Target</th><th>Content</th>
    <th>User memo</th></tr>
</thead>
<tbody id="n_list">
</tbody>
</table>

</div>

<div id="content_target" class="panel">
<h3>Configuration of notification targets and auto-generation scheme</h3>
<h4>Notification targets</h4>
<p>Currently, SMS, Phone, push notification to web browser, and email are 
supported as notification targets. Items you configured in this section are 
shown to be selectable when you add a new notification or you create a new 
auto-generation scheme to add new notifications from calendar.
Push notification to web browser need to be configured on each computer and 
browser, see 'Settings' tab for details and configuration.</p>

<div class="operation">
<span class="mi_inline" id="input_targets_getall"><i class="material-icons">refresh</i></span>
<span class="mi_inline" id="input_targets_delete"><i class="material-icons">delete</i></span>
<span class="mi_inline" id="input_targets_showadd"><i class="material-icons">add</i></span>
<span>(<span id="input_targets_count">0</span> found)</span>
</div>
<table class="list">
<colgroup>
  <col class="tab_t_check">
  <col class="tab_t_category">
  <col class="tab_t_target">
  <col class="tab_t_description">
</colgroup>
<thead>
  <tr><th></th><th>Category</th><th>Target</th><th>User memo</th></tr>
</thead>
<tbody id="t_list">
</tbody>
</table>

<h4>Auto-generation scheme</h4>
<p>Items you configured in this section are checked with (new) entries in 
google calendar of the project, and new notifications are added as configured. 
You need to have one scheme per one notification target. "Condition" does not 
accept regular expression nor cannot contain '%', but is just a string to be 
in summaries of calendar entries.</p>
<p>(Please note this is incomplete feature and could lead list of notifications 
to be duplicated or to be added for cancelled calendar entries.)</p>

<div class="operation">
<span class="mi_inline" id="input_schemes_getall"><i class="material-icons">refresh</i></span>
<span class="mi_inline" id="input_schemes_delete"><i class="material-icons">delete</i></span>
<span class="mi_inline" id="input_schemes_showadd"><i class="material-icons">add</i></span>
<span>(<span id="input_schemes_count">0</span> found)</span>
</div>
<table class="list">
<colgroup>
  <col class="tab_s_check">
  <col class="tab_s_category">
  <col class="tab_s_target">
  <col class="tab_s_minutes">
  <col class="tab_s_contents">
  <col class="tab_s_description">
</colgroup>
<thead>
  <tr><th></th><th>Condition</th><th>Target</th><th>Minutes</th>
    <th>Contents</th><th>User memo</th></tr>
</thead>
<tbody id="s_list">
</tbody>
</table>

</div>

<div id="content_settings" class="panel">
<h3>Local user interface configuration</h3>
<h4>Push notification to web browser</h4>
<div><p>To receive push notifications via your web browser, first you need to 
enable push on your each browser. After enabling push per your web browser, 
you can set target of notification by a name you entered to this form.</p>
<p>Notes per browsers. 
<ul>
  <li>Chrome: you need to "let Google Chrome run in the background" to receive 
    notifications while you don't open window of Chrome.</li>
  <li>Firefox: you will not receive push notification while you don't open 
    window of Firefox.</li>
  <li>Edge: you need to revisit to this web page every per 30days.</li>
</ul>
<p><span id="info_push">You have already enabled push notification for this 
browser with name "<span id="return_push"></span>".</span><br />
You can name push notification to this browser as 
<input type="text" name="webpush" id="input_push">
and <input type="button" id="input_push_enable" value="enable WebPush">
</p>
</div>
</div>

<div id="content_help" class="panel mi_inline">
<h3>General</h3>
<p>Operations are configured by three categories of data: notification, target, 
and scheme. 
One 'notification' is a single entry of notification to be executed at 
specified time to specified target. 
'target' is used for where notifications are delivered, like phone, SMS, 
or push notification to browsers. These are defined per user, and not shared 
among users. 
'scheme' is executed at server and is used to add a new notification from 
google calendar following configuration in scheme. If you have periodically 
scheduled meetings, system will add notifications following your 'scheme'. 
</p>
<p>Four panels (with this help panel) are provided for operation. Each icon 
is for following panel.</p>
<ul>
  <li><i class="material-icons">list</i> List of notifications</li>
  <li><i class="material-icons">publish</i> Configure targets and schemes</li>
  <li><i class="material-icons">settings</i> Your browser local configurations</li>
</ul>
<p>
Following icons are used to show operations by user:
</p>
<ul>
  <li><i class="material-icons">refresh</i> Reload list</li>
  <li><i class="material-icons">delete</i> Delete selected items in list</li>
  <li><i class="material-icons">add</i> Add new item</li>
</ul>

<h3>Notifications</h3>
<p>One 'notification' will be executed as one notification to user, which has 
properties of </p>
<ul>
  <li>Date/Time (UTC): target date/time when notification to be done, in UTC.</li>
  <li>Target: select one notification target from list of your 'target'.</li>
  <li>Content: content to be pushed as notification (like text message for SMS, voice message for Phone). Refer details and limitations in 'Notification targets' section.</li>
  <li>User memo: you can leave any memo in this field.</li>
  <li>URL: URL of a web page for webpush (push notification to your browser) which will be opened when you click poped up push notification.</li>
</ul>
<p>and also two statuses, one is for current execution status (like queued or 
fired), another is a reference ID of execution to external system (only 
internal use).</p>
<p>In list of notifications, you can 'delete' selected notification, which 
just marks the entry as 'deleted' but not to delete one from database. 
Current execution status is shown as icon as follows, and you can filter target 
to be listed in view with clicking one of following icons shown next to 
'delete' button.</p>
<ul>
  <li><i class="material-icons">highlight_off</i> show all</li>
  <li><i class="material-icons">schedule</i> queued</li>
  <li><i class="material-icons">done</i> fired</li>
  <li><i class="material-icons">remove_circle_outline</i> deleted</li>
  <li><i class="material-icons">pause_circle_outline</i> marked as invalid</li>
  <li><i class="material-icons">report_problem</i> error after execution</li>
  <li><i class="material-icons">call</i> in execution</li>
</ul>
<p>Some system does not return execution result, and notifications to these 
could remain 'in execution' even notification is successfully fired.</p>

<h3>Notification targets</h3>
<p>Following limitations are applied for notification configuration.</p>

<h4>SMS, Phone</h4>
<p>All charactors are used for output text or voice, you cannot have any 
control sequence nor unvocable charactor.</p>

<h4>Email</h4>
<p>First line will be used as Subject of email.</p>

<h4>Push notification to browser</h4>
<p>Long 'content' of notification could be trimmed by your web browser on 
showing popup.</p>

<h3>Notification auto-generation schemes</h3>
<p>Notification auto-generation schemes are used to generate/add notifications 
from google calendar (configured by sysadmin) entries automatically at server. 
You need to specify 'Condition' to match between schemes and google calendar 
entries, and configurations of notifications to be added like target of 
notification, issue notification how long (minutes) before start time of 
calendar entry, and content.</p>
<p>For now, their content is static and no template-ish conversion is 
supported.</p>

</div>

<div id="content_info" class="panel">
<div id="info_back" class="wall_back">
<div id="info_front" class="wall_front">
  <form id="content_form">

  <div id="form_notices">
    <h3>Add new notification</h3>
    <div>
      <span class="label">Date/Time (UTC):</span>
        <input type="date" name="n_targets_date" id="input_n_targets_date"
        pattern="[0-9]{4}-[0-9]{2}-[0-9]{2}" 
        title="yyyy-mm-dd" placeholder="yyyy-mm-dd">
        <input type="time" name="n_targets_time" id="input_n_targets_time"
        pattern="[0-9]{2}:[0-9]{2}" step="300"
        title="hh:mm" placeholder="hh:mm" value="00:00">
        (<span id="input_n_target"></span> at your local)
      <br />
      <span class="label">Target:</span>
        <select name="n_tid" id="input_n_tid"></select>
        <br />
      <span class="label">URL:</span>
        <input type="text" name="n_url" id="input_n_url" size="100">
        <div class="help">
          This will be used only for webpush target, which will be shown as 
          a new tab when you click notification tab. 
        </div>
      <span class="label">User memo:</span>
        <input type="text" name="n_description" id="input_n_description"
        size="30">
        <br />
      <span class="label">Content:</span>
        <div class="input_content">
          <textarea name="n_content" id="input_n_content"></textarea>
        </div>
        <div class="help">
          This will be used for text contents of notification. 
          For 'email' target, the first line will be used as email subject. 
        </div>
      <input type="hidden" name="n_source" id="input_n_source" value="web">
    </div>
    <div class="input_button">
      <input type="button" id="input_notices_post" value="Add">
      <input type="button" id="input_notices_close" value="Cancel">
    </div>
  </div>

  <div id="form_targets">
    <h3>Add new notification target</h3>
    <div>
      <span class="label">Category of target:</span>
        <select name="t_category" id="input_t_category">
          <option value="sms">SMS</option>
          <option value="phone">Phone</option>
          <option value="email">Email</option>
        </select>
        <br />
      <span class="label">Target identifier:</span>
        <input type="text" name="t_pid" id="input_t_pid" size="30">
        <br />
        <div class="help">
          This is phone number to call or to send SMS, email address, or name 
          for your each browser to push. 
          Phone numbers shall be in a format of international call, like 
          +1-1234567890 or +81-1234567890 ("-" is not a requirement, but "+" 
          is required).
          'webpush' need to be configured from 'Settings' on each browser, and 
          you cannot configure them here. 
        </div>
      <span class="label">User memo on this target:</span>
        <input type="text" name="t_description" id="input_t_description"
          size="30">
        <br />
    </div>
    <div class="input_button">
      <input type="button" id="input_targets_post" value="Add">
      <input type="button" id="input_targets_close" value="Cancel">
    </div>
  </div>

  <div id="form_schemes">
    <h3>Add new notification auto-generation scheme</h3>
    <div>
      <span class="label">Calendar entry match condition:</span>
        <input type="text" name="s_exec_cond" id="input_s_exec_cond" size="30">
        <div class="help">
          This will be used to match between notification auto-generation 
          scheme and subject of calendar entry, to get pairs to be added as 
          new notification. If input to this field (like "SpS") is contained 
          in subject of calendar entry (like "Weekly SpS telecon"), 
          new notification will be added.
          No control sequence (like one from regular expression) is evaluated, 
          this cannot have '%'.
        </div>
      <span class="label">Notification target:</span>
        <select name="n_tid" id="input_s_tid"></select>
        <br />
      <span class="label">Add notification </span>
        <input type="number" name="s_minutes" id="input_s_minutes"
          value="0" step="5">
        minutes before start time of calendar entry
        <br />
      <span class="label">User memo on this scheme:</span>
        <input type="text" name="s_description" id="input_s_description"
          size="30">
        <br />
      <span class="label">Content to be used in notification:</span>
        <div class="input_content">
          <textarea name="s_content" id="input_s_content"></textarea>
        </div>
        <div class="help">
          This will be copied to 'Content' of generated/added notification. 
          For 'email' target, the first line will be used as email subject. 
        </div>
    </div>
    <div class="input_button">
      <input type="button" id="input_schemes_post" value="Add">
      <input type="button" id="input_schemes_close" value="Cancel">
    </div>
  </div>

  </form>
</div>
</div>
</div>

</div>
</body>
</html>
